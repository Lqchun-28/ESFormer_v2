DATA_PATH: 'data/kitti'

CLASS_NAMES: ['Car', 'Pedestrian', 'Cyclist']

DATA_CONFIG:
    _BASE_CONFIG_: tools/cfgs/dataset_configs/kitti_dataset.yaml
    POINT_CLOUD_RANGE: [0, -40, -3, 70.4, 40, 1]

    DATA_AUGMENTOR:
        DISABLE_AUG_LIST: ['placeholder']
        AUG_CONFIG_LIST:
            - NAME: random_world_flip
              ALONG_AXIS_LIST: ['x']
            - NAME: random_world_rotation
              WORLD_ROT_ANGLE: [-0.78539816, 0.78539816]
            - NAME: random_world_scaling
              WORLD_SCALE_RANGE: [0.95, 1.05]

    DATA_PROCESSOR:
        - NAME: mask_points_and_boxes_outside_range
          REMOVE_OUTSIDE_BOXES: true
        - NAME: shuffle_points
          SHUFFLE_ENABLED: {'train': true, 'test': false}
        - NAME: transform_points_to_voxels
          VOXEL_SIZE: [0.16, 0.16, 4]
          MAX_POINTS_PER_VOXEL: 100
          MAX_NUMBER_OF_VOXELS: {'train': 16000, 'test': 40000}

MODEL:
  NAME: ESFormer
  USE_CHECKPOINT: false
  
  VFE:
    NAME: PillarVFE
    WITH_DISTANCE: false
    USE_ABSLOTE_XYZ: true
    USE_NORM: true
    NUM_FILTERS: [64]
    
  MAP_TO_BEV:
    NAME: PointPillarScatter
    NUM_BEV_FEATURES: 64
    
  PCES_TOOL:
    NAME: PCESTool
    HIDDEN_DIM: 64
    NUM_HEADS: 8
    MAX_POINTS_PER_PILLAR: 100
    
  BACKBONE_2D:
    NAME: SwinTransformerPlus
    INPUT_CHANNELS: 64
    PATCH_SIZE: [4, 4]
    EMBED_DIM: 96
    DEPTHS: [2, 2, 6, 2]
    NUM_HEADS: [3, 6, 12, 24]
    WINDOW_SIZE: 7
    MLP_RATIO: 4.0
    QKV_BIAS: true
    DROP_RATE: 0.0
    ATTN_DROP_RATE: 0.0
    DROP_PATH_RATE: 0.1
    
  DENSE_HEAD:
    NAME: CenterHead
    CLASS_AGNOSTIC: false
    INPUT_FEATURES: 768  # 对应 EMBED_DIM * 2^(len(DEPTHS)-1) = 96 * 2^3 = 768
    
    TARGET_ASSIGNER_CONFIG:
      FEATURE_MAP_STRIDE: 8
      NUM_MAX_OBJS: 500
      GAUSSIAN_OVERLAP: 0.1
      MIN_RADIUS: 2
      
    CLASS_NAMES_EACH_HEAD:
      - ['Car']
      - ['Pedestrian']
      - ['Cyclist']
      
    SHARED_CONV_CHANNEL: 256
    NUM_HM_CONV: 2
    
    SEPARATE_HEAD_CFG:
      HEAD_ORDER: ['center', 'center_z', 'dim', 'rot', 'iou']
      HEAD_DICT:
        center:
          out_channels: 2
          num_conv: 2
        center_z:
          out_channels: 1
          num_conv: 2
        dim:
          out_channels: 3
          num_conv: 2
        rot:
          out_channels: 2
          num_conv: 2
        iou:
          out_channels: 1
          num_conv: 2
          
    LOSS_CONFIG:
      LOSS_WEIGHTS:
        cls_weight: 1.0
        loc_weight: 2.0
        code_weights: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
        
    POST_PROCESSING:
      SCORE_THRESH: 0.1
      POST_CENTER_LIMIT_RANGE: [0, -40.0, -5.0, 70.4, 40.0, 5.0]
      MAX_OBJ_PER_SAMPLE: 500
      NMS_CONFIG:
        NMS_TYPE: nms_gpu
        NMS_THRESH: 0.01
        NMS_PRE_MAXSIZE: 4096
        NMS_POST_MAXSIZE: 500

  # 全局后处理配置
  POST_PROCESSING:
    RECALL_THRESH_LIST: [0.3, 0.5, 0.7]
    SCORE_THRESH: 0.1
    OUTPUT_RAW_SCORE: false
    
    NMS_CONFIG:
      MULTI_CLASSES_NMS: false
      NMS_TYPE: nms_gpu
      NMS_THRESH: 0.01
      NMS_PRE_MAXSIZE: 4096
      NMS_POST_MAXSIZE: 500

OPTIMIZATION:
    BATCH_SIZE_PER_GPU: 2
    NUM_EPOCHS: 80

    OPTIMIZER: adam_onecycle
    LR: 0.003
    WEIGHT_DECAY: 0.01
    MOMENTUM: 0.9

    MOMS: [0.95, 0.85]
    PCT_START: 0.4
    DIV_FACTOR: 10
    DECAY_STEP_LIST: [35, 45]
    LR_DECAY: 0.1
    LR_CLIP: 0.0000001

    LR_WARMUP: False
    WARMUP_EPOCH: 1

    GRAD_NORM_CLIP: 10